# æ–‡ä»¶å: .github/workflows/test-env-vars.yml

name: "ğŸ§ª Test Environment Variables"

# è§¦å‘æ¡ä»¶ï¼š
# 1. 'workflow_dispatch': å…è®¸ä½ åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨ç‚¹å‡» "Run workflow" æ¥è¿è¡Œã€‚
# 2. 'push': æ¯æ¬¡æ¨é€åˆ° main åˆ†æ”¯æ—¶è‡ªåŠ¨è¿è¡Œï¼ˆå¯é€‰ï¼Œå¯ä»¥æ³¨é‡Šæ‰ï¼‰ã€‚
on:
  workflow_dispatch: # è®©ä½ èƒ½æ‰‹åŠ¨è§¦å‘
  push:
    branches:
      - main # å¦‚æœä½ ä¸æƒ³æ¯æ¬¡ push éƒ½è¿è¡Œï¼Œå¯ä»¥åˆ é™¤è¿™ä¸¤è¡Œ

# åœ¨ workflow çš„é¡¶å±‚å®šä¹‰ç¯å¢ƒå˜é‡ï¼Œæ¨¡æ‹Ÿä½ çš„ä¸» workflow
env:
  RENDEZVOUS_SERVER: "${{ secrets.RENDEZVOUS_SERVER }}"
  RS_PUB_KEY: "${{ secrets.RS_PUB_KEY }}"
  # ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡ŒåŠ å…¥å…¶ä»–æƒ³æµ‹è¯•çš„å˜é‡
  # ANOTHER_VAR: "some_static_value"

jobs:
  check-variables:
    name: "Check Variables on Different OS"
    
    # ä½¿ç”¨ strategy.matrix åŒæ—¶åœ¨å¤šä¸ªæ“ä½œç³»ç»Ÿä¸Šæµ‹è¯•
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]

    runs-on: ${{ matrix.os }}

    steps:
      - name: "Print variables using GitHub context"
        run: |
          echo "OS: ${{ runner.os }}"
          echo "RENDEZVOUS_SERVER from context: [${{ env.RENDEZVOUS_SERVER }}]"
          echo "RS_PUB_KEY from context: [${{ env.RS_PUB_KEY }}]"
          
      - name: "Print variables from shell environment"
        shell: bash
        run: |
          echo "--- Shell Environment Check ---"
          echo "RENDEZVOUS_SERVER from shell: [$RENDEZVOUS_SERVER]"
          echo "RS_PUB_KEY from shell: [$RS_PUB_KEY]"
          
          echo ""
          echo "--- Conditional Check ---"
          if [ -n "$RENDEZVOUS_SERVER" ]; then
            echo "âœ… RENDEZVOUS_SERVER is SET and NOT EMPTY."
          else
            echo "âŒ RENDEZVOUS_SERVER is NOT SET or IS EMPTY."
          fi
          
          if [ -n "$RS_PUB_KEY" ]; then
            echo "âœ… RS_PUB_KEY is SET and NOT EMPTY."
          else
            echo "âŒ RS_PUB_KEY is NOT SET or IS EMPTY."
          fi
